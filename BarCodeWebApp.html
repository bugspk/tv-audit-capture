<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>TV Audit — Rename to <serial>.ext</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
  .wrap{max-width:520px;margin:0 auto;padding:16px}
  h2{margin:0 0 8px 0}
  p{color:#555;margin:8px 0}
  label{font-weight:600;display:block;margin:12px 0 6px}
  input[type=text]{width:100%;padding:10px;font-size:18px;border:1px solid #ccc;border-radius:8px}
  input[type=file]{font-size:16px}
  button{padding:10px 14px;font-size:16px;border:0;border-radius:10px;background:#2d6cdf;color:#fff}
  .ghost{background:#eee;color:#222}
  #msg{margin-top:12px;font-size:14px}
</style>
</head>
<body>
<div class="wrap">
  <h2>TV Audit v0.1 — Rename to &lt;serial&gt;.ext</h2>
  <p>Pick a saved photo (from your Camera/Photos), enter the Serial, and download it as <code>&lt;serial&gt;.ext</code>. Then upload those files to your Google Drive audit folder.</p>

  <label>Serial</label>
  <input id="serial" type="text" placeholder="Enter serial (paste from barcode scanner app if needed)…">

  <label>Photo (choose from library)</label>
  <!-- IMPORTANT: remove capture attr; let the camera app save first, then choose -->
  <input id="file" type="file" accept="image/*">

  <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
    <button id="save">Save as &lt;serial&gt;.ext</button>
    <button id="reset" class="ghost">Reset</button>
  </div>

  <div id="msg"></div>

  <details style="margin-top:12px;color:#555">
    <summary>Why this works</summary>
    <ul>
      <li>No image processing in the page → minimal memory usage.</li>
      <li>Use your phone’s Camera app first, then choose the saved photo.</li>
      <li>If you need the serial quickly, use the phone’s built-in Code Scanner (iOS Control Center / Android Lens) and paste here.</li>
    </ul>
  </details>
</div>

<script>
const serialEl = document.getElementById('serial');
const fileEl   = document.getElementById('file');
const saveBtn  = document.getElementById('save');
const resetBtn = document.getElementById('reset');
const msgEl    = document.getElementById('msg');

function safeSerial(s){ return (s||'').replace(/\s+/g,'').replace(/[^A-Za-z0-9_-]/g,''); }
function show(ok, t){ msgEl.style.color = ok ? '#0a0' : '#d00'; msgEl.textContent = t || ''; }

saveBtn.addEventListener('click', ()=>{
  const raw = (serialEl.value || '').trim();
  const f = fileEl.files && fileEl.files[0];
  if (!raw){ alert('Enter the serial first.'); serialEl.focus(); return; }
  if (!f){ alert('Choose a saved photo from your library.'); fileEl.focus(); return; }

  const safe = safeSerial(raw) || 'photo';
  // try to keep original extension
  let ext = 'jpg';
  const m = (f.name||'').match(/\.([A-Za-z0-9]+)$/);
  if (m) ext = m[1];
  else if (f.type) { const g = f.type.split('/')[1] || 'jpg'; ext = g.replace(/[^A-Za-z0-9]/g,'') || 'jpg'; }
  const outName = `${safe}.${ext.toLowerCase()}`;

  const a = document.createElement('a');
  const url = URL.createObjectURL(f);
  a.href = url;
  a.download = outName;
  document.body.appendChild(a);
  a.click();
  a.remove();
  try { URL.revokeObjectURL(url); } catch(_){}

  show(true, `Saved local copy as ${outName}. Upload to your Drive audit folder.`);
  fileEl.value = '';
  serialEl.value = '';
  serialEl.focus();
});

resetBtn.addEventListener('click', ()=>{
  fileEl.value = '';
  serialEl.value = '';
  show(true,'');
  setTimeout(()=>serialEl.focus(),200);
});
setTimeout(()=>serialEl.focus(),400);
</script>
</body>
</html>
